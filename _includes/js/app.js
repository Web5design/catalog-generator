(function(){var t,e={}.hasOwnProperty,o=function(t,o){function n(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t},n=function(t,e){return function(){return t.apply(e,arguments)}};t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.routes={"":"index",upload:"upload","import":"import","export":"export"},e.prototype.index=function(){var t;return t=new Application.Views.Index({collection:Application.datasets}),t.render()},e.prototype.upload=function(){var t;return t=new Application.Views.Upload,t.render()},e.prototype["import"]=function(){return this.navigate("upload",!0)},e.prototype["export"]=function(){var t;return t=new Application.Views.Export({collection:Application.datasets}),t.render()},e}(Backbone.Router),Application.Router=new t,Application.Models.Dataset=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.defaults=function(){var t;return t={},Application.schema.basic.forEach(function(e){return t[e.get("json")]=null}),t},e}(Backbone.Model),Application.Collections.Datasets=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.model=Application.Models.Dataset,e.prototype.getJSON=function(){return JSON.stringify(this.toJSON())},e.prototype.getHTML=function(){return this.getTemplated("html")},e.prototype.getXML=function(){return"<datasets>\n"+this.getTemplated("xml")+"</datasets>\n"},e.prototype.getTemplated=function(t){var e,o;return e="",o=Application.Templates[t],this.each(function(t){return e+=o({schema:Application.schema.basic.toJSON(),dataset:t.toJSON()})}),e},e}(Backbone.Collection),Application.Models.Field=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.defaults={definition:"",json:"",name:"",rdfa:"",type:"text",value:""},e}(Backbone.Model),Application.Collections.Fields=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.model=Application.Models.Field,e.prototype["import"]=function(t){var e=this;return _.each(t,function(t){return e.add(new Application.Models.Field(t))})},e}(Backbone.Collection),Application.Collections.Schema=function(){function t(){this.initFields=n(this.initFields,this),$.ajax("schema.yml",{success:this.initFields,async:!1})}return t.prototype.initFields=function(t){var e,o,n,r;n=jsyaml.load(t),r=[];for(o in n)e=n[o],this[o]=new Application.Collections.Fields,r.push(this[o]["import"](e));return r},t}(),Application.Views.Dataset=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.template=Application.Templates.dataset,e.prototype.el="#datasets",e.prototype.tagName="div",e.prototype.className="dataset",e.prototype.id="datasets",e.prototype.attributes={foo:"bar"},e.prototype.events={"click .remove_dataset":"removeDataset","change input":"update","click .add_multiple":"addMultiple","change .title":"renameDataset","click .add_expanded":"addExpanded"},e.prototype.render=function(){return this.$el.append(this.template(this.model.toJSON())),this.renderFields(),this},e.prototype.removeDataset=function(){return confirm("Are you sure?")?this.remove():void 0},e.prototype.renameDataset=function(t){return this.$el.children("h3").html($(t.target).val())},e.prototype.renderFields=function(){var t=this;return Application.schema.basic.forEach(function(e){var o;return e.set("value",t.model.get(e.get("json"))),o=new Application.Views.Field({model:e}),o.render()})},e.prototype.update=function(){},e.prototype.addMultiple=function(){return this.$.siblings("input").last().clone().appendTo($(this).parent())},e.prototype.addExpanded=function(){},e}(Backbone.View),Application.Views.Export=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.el="#content",e.prototype.template=Application.Templates["export"],e.prototype.events={"focus .copy_zone":"select","mouseup .copy_zone":"preventDefault"},e.prototype.render=function(){return this.$el.html(this.template({json:this.collection.getJSON(),xml:this.collection.getXML(),html:this.collection.getHTML()})),this.initDownload()},e.prototype.select=function(t){return t.target.select()},e.prototype.preventDefault=function(t){return t.preventDefault,t.stopPropegation,!1},e.prototype.initDownload=function(){return $(".download").downloadify({swf:Application.url+"/swf/downloadify.swf",downloadImage:Application.url+"/img/download.png",filename:function(){return"data."+$(this.el).attr("data-type")},data:function(){return $("#"+$(this.el).attr("data-type")).val()}})},e}(Backbone.View),Application.Views.Field=function(t){function e(){return this.input=n(this.input,this),e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.el=".fields",e.prototype.tagName="div",e.prototype["class"]="field",e.prototype.template=Application.Templates.field,e.prototype.input=function(){return Application.Templates["fields/"+this.model.get("type")]},e.prototype.render=function(){return this.$el.append(this.template({model:this.model.toJSON(),field:this.input(this.model.toJSON())}))},e}(Backbone.View),Application.Views.Import=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.el="#content",e.prototype.template=Application.Templates["import"],e.prototype.events={"click #import":"import"},e.prototype.render=function(){var t;return t=Application.Schema.basic.toJSON(),this.$el.html(this.template({schema:t,fields:this.getFields()}))},e.prototype.getFields=function(){var t;return t=[],$.each(this.collection,function(e,o){return $.each(o,function(e){return $.inArray(e,-1===t)?t.push(e):void 0})}),t},e.prototype["import"]=function(){var t=this;return $.each(this.collection,function(e,o){var n;return n=new Application.Models.Dataset,$.each(o,function(e,o){var r;return(r=t.map(e))?n.set(r,o):void 0}),Application.datasets.add(n)}),Application.Router.navigate("",!0)},e.prototype.map=function(t){return $("#map\\["+t+"\\]").val()},e}(Backbone.View),Application.Views.Index=function(t){function e(){return this.render=n(this.render,this),e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.template=Application.Templates.index,e.prototype.el="#content",e.prototype.events={"click #add_dataset":"addDataset"},e.prototype.render=function(){return this.$el.html(this.template()),this.collection.forEach(function(t){var e;return e=new Application.Views.Dataset({model:t}),e.render()})},e.prototype.addDataset=function(){return this.collection.add(new Application.Models.Dataset)},e.prototype.initialize=function(){return this.collection.on("add",this.render),0===this.collection.size()?this.addDataset():void 0},e}(Backbone.View),Application.Views.Upload=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.el="#content",e.prototype.template=Application.Templates.upload,e.prototype.events={"change input":"selectFile","dragover #drop_zone":"dragOver","dragleave #drop_zone":"dragOut","drop #drop_zone":"drop"},e.prototype.initialize=function(){return jQuery.event.props.push("dataTransfer"),this.canHazFile()?void 0:this.template='<p>Your browser is not supported. Please consider <a href="http://browsehappy.com/">upgrading</a>.'},e.prototype.render=function(){return this.$el.html(this.template())},e.prototype.canHazFile=function(){return null==window.File||null==window.FileReader||null==window.FileList||null==window.Blob?!1:!0},e.prototype.selectFile=function(t){return this.read(t.target.files[0])},e.prototype.dragOver=function(t){return t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy",$("#drop_zone").addClass("hover"),!1},e.prototype.dragOut=function(t){return t.stopPropagation(),t.preventDefault(),$("#drop_zone").removeClass("hover"),!1},e.prototype.drop=function(t){return t.stopPropagation(),t.preventDefault(),this.read(t.dataTransfer.files[0]),$("#drop_zone").removeClass("hover"),!1},e.prototype.read=function(t){var e,o=this;return e=new FileReader,e.onload=function(t){var e,n;return e=o.parseFile(t.target.result),n=new Application.Views.ImportView({collection:e}),n.render(),Application.Router.navigate("import")},e.readAsText(t)},e.prototype.parseFile=function(t){var e;try{return e=JSON.parse(t)}catch(o){return e=$.csv.toObjects(t)}finally{return e}},e}(Backbone.View)}).call(this);